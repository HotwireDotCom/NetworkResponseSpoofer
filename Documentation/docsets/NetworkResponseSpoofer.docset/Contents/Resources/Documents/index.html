<!DOCTYPE html>
<html lang="en">
  <head>
    <title>NetworkResponseSpoofer  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="NetworkResponseSpoofer  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">NetworkResponseSpoofer Docs</a> (70% documented)</p>
        <p class="header-right"><a href="https://github.com/HotwireDotCom/NetworkResponseSpoofer.git"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">NetworkResponseSpoofer Reference</a>
        <img id="carat" src="img/carat.png" />
        NetworkResponseSpoofer  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Spoofer.html">Spoofer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SpooferRecorder.html">SpooferRecorder</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/SpooferReplayer.html">SpooferReplayer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Global Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Global Variables.html#/s:22NetworkResponseSpoofer16defaultSuiteNameSSvp">defaultSuiteName</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/SpooferError.html">SpooferError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/StoreError.html">StoreError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/URLSessionConfiguration.html">URLSessionConfiguration</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/SpooferDelegate.html">SpooferDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/URLPathRangeReplacement.html">URLPathRangeReplacement</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='networkresponsespoofer' class='heading'>NetworkResponseSpoofer</h1>

<p>NetworkResponseSpoofer is a network response record and replay library for iOS, watchOS, tvOS and macOS. It&rsquo;s built on top of the <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html">Foundation URL Loading System</a> to make recording and replaying network requests really simple.</p>
<h2 id='getting-started' class='heading'>Getting Started</h2>

<p>Before you start, import Spoofer framework into your project</p>
<pre class="highlight swift"><code><span class="kd">@import</span> <span class="kt">NetworkResponseSpoofer</span>
</code></pre>
<h2 id='intercepting-responses' class='heading'>Intercepting responses</h2>

<p>Spoofer swizzles default and ephemeral session configs to insert its protocols for network intercept. In case this does not seem to work, you can create a URLSessionConfiguration extension in your project and add code similar to below (for both default and ephemeral) to have the spoofer intercept any networking interactions that happen through NSURLSession. Then use the spoofed configuration instaed of default/ephemeral in your code. Take care not to insert Spoofer protocols in release mode.</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">URLSessionConfiguration</span> <span class="p">{</span>

    <span class="kd">static</span> <span class="k">var</span> <span class="nv">spoofedDefault</span><span class="p">:</span> <span class="kt">URLSessionConfiguration</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">sessionConfig</span> <span class="o">=</span> <span class="kt">URLSessionConfiguration</span><span class="o">.</span><span class="k">default</span>
        <span class="cp">#if DEBUG</span>
            <span class="k">var</span> <span class="nv">protocolClasses</span> <span class="o">=</span> <span class="n">sessionConfig</span><span class="o">.</span><span class="n">protocolClasses</span>
            <span class="n">protocolClasses</span><span class="p">?</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">SpooferRecorder</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">protocolClasses</span><span class="p">?</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">SpooferReplayer</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">sessionConfig</span><span class="o">.</span><span class="n">protocolClasses</span> <span class="o">=</span> <span class="n">protocolClasses</span>
        <span class="cp">#endif</span>

        <span class="k">return</span> <span class="n">sessionConfig</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='start-recording' class='heading'>Start Recording</h3>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">startRecording</span><span class="p">(</span><span class="nv">inViewController</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span> <span class="c1">// Provide scenario name using popup UI</span>
<span class="o">--</span><span class="kt">OR</span><span class="o">--</span>
<span class="kt">Spoofer</span><span class="o">.</span><span class="nf">startRecording</span><span class="p">(</span><span class="nv">scenarioName</span><span class="p">:</span> <span class="s">"Give a name to your scenario"</span><span class="p">)</span>  <span class="c1">// Provide scenario name directly from code</span>
</code></pre>

<p>Recording can be either initiated by providing the scenario name from UI (BDD / UI Tests / Manually) or from code if you prefer it that way. Each scenario needs a name. Preferably keep this short so that it can be displayed as a list in device/simulator without word wrap. Once a cycle of recording finishes (end to end), stop the recording and this will save the requests and responses for that session under the scenario.</p>
<h3 id='stop-recording' class='heading'>Stop Recording</h3>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">stopRecording</span><span class="p">()</span>
</code></pre>

<p>Stops recording and saves the scenario in the application&rsquo;s sandboxed Documents directory (under /Spoofer)</p>
<h3 id='start-replay' class='heading'>Start Replay</h3>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">showRecordedScenarios</span><span class="p">(</span><span class="nv">inViewController</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span> <span class="c1">// Shows a list of recorded scenarios, select one to start replay</span>
<span class="o">--</span><span class="kt">OR</span><span class="o">--</span>
<span class="kt">Spoofer</span><span class="o">.</span><span class="nf">startReplaying</span><span class="p">(</span><span class="nv">scenarioName</span><span class="p">:</span> <span class="s">"Scenario name to replay"</span><span class="p">)</span> <span class="c1">// Directly start replaying a recorded scenario</span>
</code></pre>

<p>The first method displays a list of recorded scenarios available in the application documents directory. Tapping a scenario from the list starts replay immediately serving the responses from inside the scenario. If you know the scenario name already and do not want a selection UI, use the second method. The UI also allows configuring the Spoofer behavior and toggling a few settings, so give it a spin.</p>
<h3 id='stop-replay' class='heading'>Stop Replay</h3>

<p>Stop replaying the current scenario</p>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">stopReplaying</span><span class="p">()</span>
</code></pre>
<h2 id='exporting-and-importing-scenarios' class='heading'>Exporting and Importing scenarios</h2>

<p>Spoofer uses the sandboxed documents folder of the app to save the scenario files.</p>
<h2 id='documentation' class='heading'>Documentation</h2>

<p>Read the <a href="./Classes/Spoofer.html">docs</a>.</p>
<h2 id='advanced-configuration' class='heading'>Advanced Configuration</h2>
<h3 id='whitelisting-host-names' class='heading'>Whitelisting host names</h3>

<p>By default, the spoofer will intercept and save all HTTP requests and responses originating from an app. If you need to be selective, provide an array of domains you want to record requests and responses from as below. Once domainsToSpoof is set, only the specified domain calls will be intercepted.</p>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">hostNamesToSpoof</span><span class="p">([</span><span class="s">"example1.com"</span><span class="p">,</span><span class="s">"example2.com"</span><span class="p">])</span>
</code></pre>
<h3 id='blacklisting-host-names' class='heading'>Blacklisting host names</h3>

<p>Blacklist does the opposite of above, allowing selective domain names to be ignored while Spoofer records Network requests and responses.</p>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">hostNamesToIgnore</span><span class="p">([</span><span class="s">"example3.com"</span><span class="p">,</span><span class="s">"example4.com"</span><span class="p">])</span>
</code></pre>
<h3 id='ignoring-subdomains' class='heading'>Ignoring subdomains</h3>

<p>If end points have subdomains that need to be ignored, those can be set as below. This allows responses recorded from one realm to be played back on another. Spoofer normalizes the URL so that <strong>example.qa.com</strong> becomes <strong>example.com</strong></p>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">subDomainsToIgnore</span><span class="p">([</span><span class="s">"DEV"</span><span class="p">,</span><span class="s">"QA"</span><span class="p">,</span><span class="s">"PREPROD"</span><span class="p">])</span>
</code></pre>
<h3 id='ignoring-query-parameters' class='heading'>Ignoring query parameters</h3>

<p>If constructed URL&rsquo;s contain query parameters which appear and go away dynamically, response lookup might fail during replay. To avoid that, setup ignore rules for such query parameters so that they are removed before URL&rsquo;s are compared.</p>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="nf">queryParametersToIgnore</span><span class="p">([</span><span class="s">"node"</span><span class="p">,</span><span class="s">"swarm"</span><span class="p">,</span><span class="s">"cluster"</span><span class="p">])</span>
</code></pre>
<h3 id='normalize-query-parameters' class='heading'>Normalize query parameters</h3>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="n">normalizeQueryParameters</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre>

<p>Query Parameter Normalization causes values (not keys) of the query parameters to be dropped while comparing URL&rsquo;s. For most cases this means only one response is saved per end point if the query parameter keys are the same. Effects are</p>

<ol>
<li>Reduced scenario file size saving some storage space.</li>
<li>Consistent response for the same end point regardless of query parameter values</li>
</ol>
<h3 id='allow-self-signed-certificate' class='heading'>Allow self signed certificate</h3>
<pre class="highlight swift"><code><span class="kt">Spoofer</span><span class="o">.</span><span class="n">allowSelfSignedCertificate</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre>

<p>Allow spoofer to record from self signed certificate authority domains</p>
<h2 id='receiving-call-back-from-the-spoofer' class='heading'>Receiving call back from the spoofer</h2>
<h5 id='method-1' class='heading'>Method 1</h5>

<p>If you need to update UI or respond to the spoofer state changes, implement the SpooferDelegate protocol and use the delegate callbacks to do so.</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">MyClass</span><span class="p">:</span> <span class="kt">SpooferDelegate</span> <span class="p">{</span>

    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Some setup code</span>
        <span class="o">...</span>
        <span class="kt">Spoofer</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="p">}</span>

<span class="p">}</span>

</code></pre>

<p>And then implement the below methods</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">spooferDidStartRecording</span><span class="p">(</span><span class="nv">scenarioName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="kd">func</span> <span class="nf">spooferDidStopRecording</span><span class="p">(</span><span class="nv">scenarioName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="kd">func</span> <span class="nf">spooferDidStartReplaying</span><span class="p">(</span><span class="nv">scenarioName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">success</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="kd">func</span> <span class="nf">spooferDidStopReplaying</span><span class="p">(</span><span class="nv">scenarioName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
</code></pre>
<h5 id='method-2' class='heading'>Method 2</h5>

<p>Spoofer will fire the following notifications whenever its state changes. You can subscribe to these notifications and do any related work.</p>

<ul>
<li>spooferStartedRecordingNotification</li>
<li>spooferStoppedRecordingNotification</li>
<li>spooferStartedReplayingNotification</li>
<li>spooferStoppedReplayingNotification</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='cocoapods' class='heading'>Cocoapods</h3>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s2">"NetworkResponseSpoofer"</span>
</code></pre>
<h3 id='carthage' class='heading'>Carthage</h3>
<pre class="highlight ruby"><code><span class="n">github</span> <span class="s2">"HotwireDotCom/NetworkResponseSpoofer"</span>
</code></pre>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="www.hotwire.com" target="_blank" rel="external">Hotwire</a>. All rights reserved. (Last updated: 2018-11-09)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
